{% extends "base.html" %}

{% block title %}
    Proficiency_Matrix
{% endblock %}

{% block content %}
<h1 align="center">Proficiency Matrix</h1>
<p>This table displays proficiencies for all users, for all skills. Filter by category or group of skills.</p>
<span style = "background-color:black ; color:#FFFFFF; font-size: 0.875em">&nbsp; 0-Not Evaluated &nbsp;</span>
<span style = "background-color:#05106E ; color:#FFFFFF; font-size: 0.875em">&nbsp; 1-No Awareness &nbsp;</span>
<span style = "background-color:#0A37A6 ; color:#FFFFFF; font-size: 0.875em">&nbsp; 2-Beginner / Learn &nbsp;</span>
<span style = "background-color:#007DFF ; color:#FFFFFF; font-size: 0.875em">&nbsp; 3-Intermediate / Deliver &nbsp;</span>
<span style = "background-color:#0CA4EB ; color:#FFFFFF; font-size: 0.875em">&nbsp; 4-Advanced / Perform &nbsp;</span>
<span style = "background-color:#0DE0FF ; color:#FFFFFF; font-size: 0.875em">&nbsp; 5-Expert / Coach &nbsp;</span>
<br>
<br>
<div>
    Filter by Group:
    <select id="groupFilter">
        <option value="all">All Groups</option>
        <!-- Options will be dynamically populated with available groups -->
        {% for group in available_groups %}
            <option value="{{ group.group_id }}" {% if group.group_id == selected_group_id %} selected {% endif %}>{{ group.group_name }}</option>
        {% endfor %}
    </select>
    <button onclick="showOnlyGroup()">Apply Group filter</button>
    &nbsp;&nbsp;&nbsp;&nbsp;
    Filter by Category:
    <select id="categoryFilter">
        <option value="all">All Categories</option>
        <!-- Options will be dynamically populated with available categories -->
        {% for category in available_categories %}
            <option value="{{ category.category_id }}" {% if category.category_id == selected_category_id  %} selected {% endif %}>{{ category.category_name }}</option>
        {% endfor %}
    </select>
    <button onclick="showOnlyCategory()">Apply Category filter</button>
    &nbsp;&nbsp;&nbsp;&nbsp;
    <button onclick="showAllSkills()">Show All Skills</button>
</div>
<br>
<table id="proficiencyMatrix" class="display">
    <thead>
        <tr>
            <th>User</th>
            <!-- Loop through the skills to create columns -->
            {% for a_skill in list_all_skills %}
                <th>{{ a_skill.skill_name }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        <!-- Loop through the users to create rows -->
        {% for a_user in list_all_users %}
            <tr>
                <td>{{ a_user.first_name }} {{ a_user.last_name }}</td>
                <!-- Loop through the skills to populate proficiency values -->
                {% for a_skill in list_all_skills %}
                    <td data-value="{{ matrix.at[a_user.id,a_skill.skill_id] }}">{{ matrix.at[a_user.id,a_skill.skill_id] }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.11.6/js/jquery.dataTables.min.js"></script>
<script>
    function showOnlyGroup() {
        var selectedGroup = document.getElementById("groupFilter").value;
        if (selectedGroup !== "all") {
            // Reload the page with the selected group filter
            window.location.href = "/proficiencies?group=" + selectedGroup;
        }
    }

    function showAllSkills() {
        // Reload the page to show all skills
        window.location.href = "/proficiencies";
    }

    // Initialize DataTables
    $(document).ready(function () {
        $('#proficiencyMatrix').DataTable();
    });

    function showOnlyCategory() {
        var selectedCategory = document.getElementById("categoryFilter").value;
        if (selectedCategory !== "all") {
            // Reload the page with the selected category filter
            window.location.href = "/proficiencies?category=" + selectedCategory;
        }
    }
</script>
{% endblock %}
